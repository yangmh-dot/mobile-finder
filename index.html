<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI å½±ç‰‡æœå°‹å™¨</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#3b82f6">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #f9fafc; color: #1f2937; font-family: 'Inter', sans-serif; }
    header { border-bottom: 3px solid #3b82f6; background: white; }
    .card { background: white; border: 1px solid #cfe1ff; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    .btn { background: #3b82f6; color: white; border-radius: 0.5rem; padding: 0.5rem 1rem; font-weight: 500; }
    .btn:hover { background: #2563eb; }
    select, input { border: 1px solid #93c5fd; border-radius: 0.5rem; padding: 0.4rem 0.6rem; }
    #results img { border-radius: 0.5rem; transition: transform 0.2s; }
    #results img:hover { transform: scale(1.05); }
  </style>
</head>
<body>
<header class="px-4 py-3 flex justify-between items-center">
  <div class="text-lg font-semibold text-blue-700">ğŸ“¸ AI å½±ç‰‡æœå°‹å™¨</div>
  <button id="btnSettings" class="text-blue-600 font-medium">âš™ï¸ Settings</button>
</header>

<main class="max-w-4xl mx-auto p-4 space-y-4">
  <section class="card p-4 rounded-xl">
    <h2 class="text-lg font-semibold mb-2 text-blue-700">æœå°‹è¨­å®š / Search Settings</h2>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
      <div><label class="text-sm">Country åœ‹å®¶</label><select id="country" class="w-full"></select></div>
      <div><label class="text-sm">City åŸå¸‚</label><select id="city" class="w-full"></select></div>
      <div><label class="text-sm">Theme ä¸»é¡Œ</label><select id="theme" class="w-full"></select></div>
      <div><label class="text-sm">Keywords é—œéµå­—</label><input id="keywords" class="w-full" placeholder="sunset, skyline, cats"></div>
    </div>
    <div class="mt-3 flex gap-2">
      <button id="btnSearch" class="btn">ğŸ” Search</button>
      <button id="btnClear" class="btn bg-gray-300 text-gray-700">Clear</button>
      <button id="btnGenerate" class="btn bg-green-500">âœ¨ Generate Titles</button>
    </div>
  </section>

  <section id="results" class="grid grid-cols-2 md:grid-cols-3 gap-3"></section>
  <div id="loading" class="text-center text-blue-600 hidden">â³ Loading...</div>

  <div id="output" class="card p-4 rounded-xl hidden">
    <h3 class="text-blue-700 font-semibold mb-2">ğŸ¬ AI å½±ç‰‡æ¨™é¡Œèˆ‡æè¿°ç”Ÿæˆ / Title & Description</h3>
    <div class="flex gap-2 mb-2">
      <button class="btn bg-blue-500" data-mode="cinematic">Cinematic</button>
      <button class="btn bg-purple-500" data-mode="seo">SEO</button>
      <button class="btn bg-pink-500" data-mode="clickbait">Clickbait</button>
    </div>
    <pre id="textOutput" class="whitespace-pre-wrap text-sm"></pre>
  </div>
</main>

<!-- Settings modal -->
<div id="settingsModal" class="hidden fixed inset-0 bg-black/50 flex justify-center items-center">
  <div class="bg-white p-5 rounded-xl w-80">
    <h3 class="text-blue-700 font-semibold mb-2">âš™ï¸ API è¨­å®š</h3>
    <p class="text-sm mb-2">è¼¸å…¥ä½ çš„ Pexels API Keyï¼ˆé¸å¡«ï¼‰ï¼š</p>
    <input id="pexelsKey" type="text" placeholder="Pexels API Key" class="w-full border p-2 mb-3 rounded">
    <div class="flex justify-end gap-2">
      <button id="btnSaveKey" class="btn">Save</button>
      <button id="btnCloseSettings" class="btn bg-gray-300 text-gray-700">Close</button>
    </div>
  </div>
</div>

<script>
const DATA={"Any":["Any"],"United States":["Any","New York","Los Angeles","San Francisco","Chicago","Seattle","Las Vegas","Miami","Boston"],"Japan":["Any","Tokyo","Kyoto","Osaka","Sapporo","Okinawa"],"Taiwan":["Any","Taipei","Taichung","Tainan","Kaohsiung"]};
const THEMES=["Any","Animals","Nature","Architecture","Food","People","Night View","Beach & Ocean","City Streets","Countryside","Mountains","Sports"];
const country=document.getElementById("country"),city=document.getElementById("city"),theme=document.getElementById("theme");
for(const c in DATA){let o=document.createElement("option");o.textContent=c;country.appendChild(o);}
for(const t of THEMES){let o=document.createElement("option");o.textContent=t;theme.appendChild(o);}
country.addEventListener("change",()=>{city.innerHTML='';(DATA[country.value]||["Any"]).forEach(x=>{let o=document.createElement("option");o.textContent=x;city.appendChild(o);});});
country.dispatchEvent(new Event("change"));
const btnSearch=document.getElementById("btnSearch"),btnClear=document.getElementById("btnClear"),results=document.getElementById("results"),loading=document.getElementById("loading");
btnSearch.addEventListener("click",async()=>{
  results.innerHTML='';loading.classList.remove("hidden");
  const q=[country.value,city.value,theme.value,document.getElementById("keywords").value].filter(x=>x!=="Any"&&x.trim()).join(" ");
  const key=localStorage.getItem("pexelsKey");
  try{
    let data;
    if(key){
      const res=await fetch(`https://api.pexels.com/v1/search?query=${encodeURIComponent(q)}&per_page=9`,{headers:{Authorization:key}});
      const j=await res.json();data=j.photos.map(p=>p.src.medium);
    }else{
      const res=await fetch(`https://commons.wikimedia.org/w/api.php?action=query&format=json&origin=*&generator=search&gsrsearch=${encodeURIComponent(q)}&gsrlimit=9&prop=imageinfo&iiprop=url`);
      const j=await res.json();data=Object.values(j.query?.pages||{}).map(p=>p.imageinfo?.[0]?.url).filter(Boolean);
    }
    results.innerHTML=data.map(u=>`<a href='${u}' target='_blank'><img src='${u}' class='w-full'></a>`).join('');
  }catch(e){results.innerHTML='<p class=\"text-red-500\">âŒ æœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</p>';}
  loading.classList.add("hidden");
});
btnClear.addEventListener("click",()=>{results.innerHTML='';document.getElementById("keywords").value='';});

const output=document.getElementById("output"),btnGenerate=document.getElementById("btnGenerate"),textOutput=document.getElementById("textOutput");
btnGenerate.addEventListener("click",()=>{
  output.classList.remove("hidden");
  const q=[country.value,city.value,theme.value,document.getElementById("keywords").value].filter(x=>x!=="Any"&&x.trim()).join(" ");
  function makeText(mode){
    if(mode==='cinematic')return`ğŸ¬ *Cinematic Title*\\nEN: Journey Through ${q}\\nZH: ${q} çš„é›»å½±æ„Ÿç•«é¢`;
    if(mode==='seo')return`ğŸ§­ *SEO Title*\\nEN: Discover ${q} in 4K â€“ Travel Highlights\\nZH: æ¢ç´¢${q}çš„æ—…éŠäº®é»`;
    if(mode==='clickbait')return`ğŸ˜‚ *Clickbait Title*\\nEN: You Wonâ€™t Believe What Happened in ${q}!\\nZH: ${q} ç™¼ç”Ÿçš„äº‹ä½ çµ•å°æƒ³ä¸åˆ°ï¼`;
  }
  textOutput.textContent=makeText('cinematic');
  output.querySelectorAll('button[data-mode]').forEach(b=>b.addEventListener('click',()=>{textOutput.textContent=makeText(b.dataset.mode);}));
});

// Settings modal
const modal=document.getElementById("settingsModal"),btnSettings=document.getElementById("btnSettings"),btnClose=document.getElementById("btnCloseSettings"),btnSave=document.getElementById("btnSaveKey");
btnSettings.onclick=()=>{document.getElementById("pexelsKey").value=localStorage.getItem("pexelsKey")||'';modal.classList.remove("hidden");};
btnClose.onclick=()=>modal.classList.add("hidden");
btnSave.onclick=()=>{localStorage.setItem("pexelsKey",document.getElementById("pexelsKey").value.trim());alert("âœ… å·²å„²å­˜ API Key");modal.classList.add("hidden");};

// SW register
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js").then(()=>console.log("SW ok")).catch(e=>console.error("SW fail",e));
}
</script>
</body>
</html>
